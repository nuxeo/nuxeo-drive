<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="555px" preserveAspectRatio="none" style="width:705px;height:555px;" version="1.1" viewBox="0 0 705 555" width="705px" zoomAndPan="magnify"><defs><filter height="300%" id="f38oc0sv59ysf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f38oc0sv59ysf)" height="100.5313" style="stroke: #000000; stroke-width: 2.0;" width="591.5" x="13" y="197.6016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="51" x2="51" y1="52.9375" y2="515.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="445.5" x2="445.5" y1="52.9375" y2="515.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="504.5" x2="504.5" y1="52.9375" y2="515.0625"/><rect fill="#FEFECE" filter="url(#f38oc0sv59ysf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="17.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="37.6357">Client</text><rect fill="#FEFECE" filter="url(#f38oc0sv59ysf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="514.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="534.0576">Client</text><rect fill="#FEFECE" filter="url(#f38oc0sv59ysf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="427.5" y="17.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="37.6357">S3</text><rect fill="#FEFECE" filter="url(#f38oc0sv59ysf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="427.5" y="514.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="534.0576">S3</text><rect fill="#FEFECE" filter="url(#f38oc0sv59ysf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="473.5" y="17.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="480.5" y="37.6357">Nuxeo</text><rect fill="#FEFECE" filter="url(#f38oc0sv59ysf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="473.5" y="514.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="480.5" y="534.0576">Nuxeo</text><polygon fill="#008000" points="433.5,92.6367,443.5,96.6367,433.5,100.6367,437.5,96.6367" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="51.5" x2="439.5" y1="96.6367" y2="96.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="58.5" y="91.5708">Ask for uploaded chunks using a given multipart upload ID</text><path d="M450,67.9375 L450,107.9375 L679,107.9375 L679,77.9375 L669,67.9375 L450,67.9375 " fill="#FBFB77" filter="url(#f38oc0sv59ysf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M669,67.9375 L669,77.9375 L679,77.9375 L669,67.9375 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="456" y="85.0044">API: ListParts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="456" y="100.1372">ACL: s3:ListMultipartUploadParts</text><polygon fill="#008000" points="62.5,134.3359,52.5,138.3359,62.5,142.3359,58.5,138.3359" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="444.5" y1="138.3359" y2="138.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="68.5" y="133.27">Uploaded chunks</text><line style="stroke: #FF0000; stroke-width: 2.0;" x1="427.5" x2="437.5" y1="177.6016" y2="187.6016"/><line style="stroke: #FF0000; stroke-width: 2.0;" x1="427.5" x2="437.5" y1="187.6016" y2="177.6016"/><line style="stroke: #FF0000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51.5" x2="432.5" y1="182.6016" y2="182.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="58.5" y="162.4028">No such multipart upload ID or</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="261.5" y="162.4028">no enough ACL</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="372.5" y="162.4028">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="58.5" y="177.5356">stop now and start a new S3 upload</text><path d="M13,197.6016 L90,197.6016 L90,204.6016 L80,214.6016 L13,214.6016 L13,197.6016 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="100.5313" style="stroke: #000000; stroke-width: 2.0;" width="591.5" x="13" y="197.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="28" y="210.6685">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="105" y="209.812">[missing chunks count]</text><polygon fill="#0000FF" points="433.5,244.4336,443.5,248.4336,433.5,252.4336,437.5,248.4336" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="51.5" x2="439.5" y1="248.4336" y2="248.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="58.5" y="243.3677">Upload chunk N</text><path d="M450,219.7344 L450,259.7344 L585,259.7344 L585,229.7344 L575,219.7344 L450,219.7344 " fill="#FBFB77" filter="url(#f38oc0sv59ysf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M575,219.7344 L575,229.7344 L585,229.7344 L575,219.7344 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="456" y="236.8013">API: UploadPart</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="456" y="251.9341">ACL: s3:PutObject</text><polygon fill="#0000FF" points="62.5,286.1328,52.5,290.1328,62.5,294.1328,58.5,290.1328" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="444.5" y1="290.1328" y2="290.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="68.5" y="285.0669">Chunk N uploaded</text><polygon fill="#FFA500" points="433.5,334.832,443.5,338.832,433.5,342.832,437.5,338.832" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0;" x1="51.5" x2="439.5" y1="338.832" y2="338.832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="58.5" y="333.7661">Complete the multipart upload</text><path d="M450,310.1328 L450,350.1328 L662,350.1328 L662,320.1328 L652,310.1328 L450,310.1328 " fill="#FBFB77" filter="url(#f38oc0sv59ysf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M652,310.1328 L652,320.1328 L662,320.1328 L652,310.1328 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="456" y="327.1997">API: CompleteMultipartUpload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="456" y="342.3325">ACL: s3:PutObject</text><polygon fill="#FFA500" points="62.5,376.5313,52.5,380.5313,62.5,384.5313,58.5,380.5313" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="444.5" y1="380.5313" y2="380.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="375.4653">Response OK</text><polygon fill="#A80036" points="492.5,405.6641,502.5,409.6641,492.5,413.6641,496.5,409.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="498.5" y1="409.6641" y2="409.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="58.5" y="404.5981">Complete the upload</text><polygon fill="#A80036" points="62.5,434.7969,52.5,438.7969,62.5,442.7969,58.5,438.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="503.5" y1="438.7969" y2="438.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="433.731">Response OK</text><polygon fill="#A80036" points="492.5,463.9297,502.5,467.9297,492.5,471.9297,496.5,467.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="498.5" y1="467.9297" y2="467.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="58.5" y="462.8638">Attach the blob to the document</text><polygon fill="#A80036" points="62.5,493.0625,52.5,497.0625,62.5,501.0625,58.5,497.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="503.5" y1="497.0625" y2="497.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="491.9966">Response OK</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="100" x="593.5" y="12.2822">Resume a S3 upload</text><!--
@startuml img/resume-upload-s3.svg
header Resume a S3 upload

Client -[#green]> S3: Ask for uploaded chunks using a given multipart upload ID
note right: API: ListParts\nACL: s3:ListMultipartUploadParts
Client <[#green]- - S3: Uploaded chunks
Client - -[#red]x S3: No such multipart upload ID or  **no enough ACL**:\nstop now and start a new S3 upload

loop missing chunks count
Client -[#blue]> S3: Upload chunk N
note right: API: UploadPart\nACL: s3:PutObject
Client <[#blue]- - S3: Chunk N uploaded
end

Client -[#orange]> S3: Complete the multipart upload
note right: API: CompleteMultipartUpload\nACL: s3:PutObject
Client <[#orange]- - S3: Response OK

Client -> Nuxeo: Complete the upload
Client <- - Nuxeo: Response OK

Client -> Nuxeo: Attach the blob to the document
Client <- - Nuxeo: Response OK

@enduml

PlantUML version 1.2018.13(Mon Nov 26 18:11:51 CET 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.5+10-post-Debian-1deb10u1
Operating System: Linux
OS Version: 4.19.0-6-amd64
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>
