<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="569px" preserveAspectRatio="none" style="width:611px;height:569px;" version="1.1" viewBox="0 0 611 569" width="611px" zoomAndPan="magnify"><defs><filter height="300%" id="f15loyfar3dk4n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f15loyfar3dk4n)" height="100.5313" style="stroke: #000000; stroke-width: 2.0;" width="514.5" x="13" y="211.6016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="51" x2="51" y1="52.9375" y2="529.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="309.5" x2="309.5" y1="52.9375" y2="529.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="368.5" x2="368.5" y1="52.9375" y2="529.0625"/><rect fill="#FEFECE" filter="url(#f15loyfar3dk4n)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="17.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="37.6357">Client</text><rect fill="#FEFECE" filter="url(#f15loyfar3dk4n)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="528.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="548.0576">Client</text><rect fill="#FEFECE" filter="url(#f15loyfar3dk4n)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="278.5" y="17.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="285.5" y="37.6357">Nuxeo</text><rect fill="#FEFECE" filter="url(#f15loyfar3dk4n)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="278.5" y="528.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="285.5" y="548.0576">Nuxeo</text><rect fill="#FEFECE" filter="url(#f15loyfar3dk4n)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="350.5" y="17.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="357.5" y="37.6357">S3</text><rect fill="#FEFECE" filter="url(#f15loyfar3dk4n)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="350.5" y="528.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="357.5" y="548.0576">S3</text><polygon fill="#008000" points="297.5,80.0703,307.5,84.0703,297.5,88.0703,301.5,84.0703" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="51.5" x2="303.5" y1="84.0703" y2="84.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="58.5" y="79.0044">Ask for bucket details and a batch ID</text><polygon fill="#008000" points="62.5,109.2031,52.5,113.2031,62.5,117.2031,58.5,113.2031" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="308.5" y1="113.2031" y2="113.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="68.5" y="108.1372">Bucket details and batch ID</text><polygon fill="#A80036" points="356.5,150.9023,366.5,154.9023,356.5,158.9023,360.5,154.9023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="362.5" y1="154.9023" y2="154.9023"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="58.5" y="149.8364">Create a new multipart upload</text><path d="M373,126.2031 L373,166.2031 L566,166.2031 L566,136.2031 L556,126.2031 L373,126.2031 " fill="#FBFB77" filter="url(#f15loyfar3dk4n)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M556,126.2031 L556,136.2031 L566,136.2031 L556,126.2031 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="379" y="143.27">API: CreateMultipartUpload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="379" y="158.4028">ACL: s3:PutObject</text><polygon fill="#A80036" points="62.5,192.6016,52.5,196.6016,62.5,200.6016,58.5,196.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="367.5" y1="196.6016" y2="196.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="191.5356">Response OK</text><path d="M13,211.6016 L90,211.6016 L90,218.6016 L80,228.6016 L13,228.6016 L13,211.6016 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="100.5313" style="stroke: #000000; stroke-width: 2.0;" width="514.5" x="13" y="211.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="28" y="224.6685">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95" x="105" y="223.812">[chunks count]</text><polygon fill="#0000FF" points="356.5,258.4336,366.5,262.4336,356.5,266.4336,360.5,262.4336" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="51.5" x2="362.5" y1="262.4336" y2="262.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="58.5" y="257.3677">Upload chunk N</text><path d="M373,233.7344 L373,273.7344 L508,273.7344 L508,243.7344 L498,233.7344 L373,233.7344 " fill="#FBFB77" filter="url(#f15loyfar3dk4n)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M498,233.7344 L498,243.7344 L508,243.7344 L498,233.7344 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="379" y="250.8013">API: UploadPart</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="379" y="265.9341">ACL: s3:PutObject</text><polygon fill="#0000FF" points="62.5,300.1328,52.5,304.1328,62.5,308.1328,58.5,304.1328" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="367.5" y1="304.1328" y2="304.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="68.5" y="299.0669">Chunk N uploaded</text><polygon fill="#FFA500" points="356.5,348.832,366.5,352.832,356.5,356.832,360.5,352.832" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0;" x1="51.5" x2="362.5" y1="352.832" y2="352.832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="58.5" y="347.7661">Complete the multipart upload</text><path d="M373,324.1328 L373,364.1328 L585,364.1328 L585,334.1328 L575,324.1328 L373,324.1328 " fill="#FBFB77" filter="url(#f15loyfar3dk4n)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M575,324.1328 L575,334.1328 L585,334.1328 L575,324.1328 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="379" y="341.1997">API: CompleteMultipartUpload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="379" y="356.3325">ACL: s3:PutObject</text><polygon fill="#FFA500" points="62.5,390.5313,52.5,394.5313,62.5,398.5313,58.5,394.5313" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="367.5" y1="394.5313" y2="394.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="389.4653">Response OK</text><polygon fill="#A80036" points="297.5,419.6641,307.5,423.6641,297.5,427.6641,301.5,423.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="303.5" y1="423.6641" y2="423.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="58.5" y="418.5981">Complete the upload</text><polygon fill="#A80036" points="62.5,448.7969,52.5,452.7969,62.5,456.7969,58.5,452.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="308.5" y1="452.7969" y2="452.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="447.731">Response OK</text><polygon fill="#A80036" points="297.5,477.9297,307.5,481.9297,297.5,485.9297,301.5,481.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="303.5" y1="481.9297" y2="481.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="58.5" y="476.8638">Attach the blob to the document</text><polygon fill="#A80036" points="62.5,507.0625,52.5,511.0625,62.5,515.0625,58.5,511.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="56.5" x2="308.5" y1="511.0625" y2="511.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="68.5" y="505.9966">Response OK</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="73" x="526.5" y="12.2822">New S3 upload</text><!--
@startuml img/new-upload-s3.svg
header New S3 upload

Client -[#green]> Nuxeo: Ask for bucket details and a batch ID
Client <[#green]- - Nuxeo: Bucket details and batch ID

Client -> S3: Create a new multipart upload
note right: API: CreateMultipartUpload\nACL: s3:PutObject
Client <- - S3: Response OK

loop chunks count
Client -[#blue]> S3: Upload chunk N
note right: API: UploadPart\nACL: s3:PutObject
Client <[#blue]- - S3: Chunk N uploaded
end

Client -[#orange]> S3: Complete the multipart upload
note right: API: CompleteMultipartUpload\nACL: s3:PutObject
Client <[#orange]- - S3: Response OK

Client -> Nuxeo: Complete the upload
Client <- - Nuxeo: Response OK

Client -> Nuxeo: Attach the blob to the document
Client <- - Nuxeo: Response OK

@enduml

PlantUML version 1.2018.13(Mon Nov 26 18:11:51 CET 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.5+10-post-Debian-1deb10u1
Operating System: Linux
OS Version: 4.19.0-6-amd64
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>
